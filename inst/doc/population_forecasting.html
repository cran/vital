<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Rob J Hyndman" />


<title>Stochastic population forecasting</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">

div.csl-bib-body { }
div.csl-entry {
clear: both;
margin-bottom: 0em;
}
.hanging div.csl-entry {
margin-left:2em;
text-indent:-2em;
}
div.csl-left-margin {
min-width:2em;
float:left;
}
div.csl-right-inline {
margin-left:2em;
padding-left:1em;
}
div.csl-indent {
margin-left: 2em;
}
</style>

<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Stochastic population forecasting</h1>
<h4 class="author">Rob J Hyndman</h4>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(vital)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(fable)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2025</span>)</span></code></pre></div>
<p>The vital package can be used for stochastic population forecasting
with coherent components. This is based on the papers by <span class="citation">Hyndman and Booth (2008)</span> and <span class="citation">Hyndman, Booth, and Yasmeen (2013)</span>. Following
<span class="citation">Hyndman and Booth (2008)</span>, we use the
following demographic growth-balance equations: <span class="math display">\[
P_t(x) = P_{t-1}(x) + B_t(x) - D_t(x) + G_t(x)
\]</span> where</p>
<ul>
<li><span class="math inline">\(P_t(x)\)</span> is the population at
time <span class="math inline">\(t\)</span> and age <span class="math inline">\(x\)</span>,</li>
<li><span class="math inline">\(B_t(x)\)</span> is the number of births
at time <span class="math inline">\(t\)</span> and age <span class="math inline">\(x\)</span>,</li>
<li><span class="math inline">\(D_t(x)\)</span> is the number of deaths
at time <span class="math inline">\(t\)</span> and age <span class="math inline">\(x\)</span>, and</li>
<li><span class="math inline">\(G_t(x)\)</span> is the number of net
migrants at time <span class="math inline">\(t\)</span> and age <span class="math inline">\(x\)</span>.</li>
</ul>
<p>There are slightly different equations for handling the upper age
group, and for baby migrants. See <span class="citation">Hyndman and
Booth (2008)</span> for details.</p>
<p>To simulate future births, deaths and net migrants, we develop three
functional data models for fertility, mortality and migration. The
models for mortality and migration use coherent components, so that the
rates for males and females do not diverge over time.</p>
<p>The following example uses Norwegian data up to 2022, and produces
simulated populations for the ten future years. Different models are
used for each component to demonstrate the flexibility of the package,
but other models can be used as well.</p>
<div id="mortality-model" class="section level2">
<h2>Mortality model</h2>
<p>We use a coherent functional data model <span class="citation">(Hyndman, Booth, and Yasmeen 2013)</span> for the log
mortality rates. To ensure coherence, we compute the geometric mean of
the sex-specific mortality rates and the corresponding ratios, using the
<code>make_pr()</code> function. The data are smoothed first, and 6
components are used by default in each FDM, although only the first two
are plotted here.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>fit_mortality <span class="ot">&lt;-</span> norway_mortality <span class="sc">|&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>  <span class="fu">filter</span>(Sex <span class="sc">!=</span> <span class="st">&quot;Total&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>  <span class="fu">smooth_mortality</span>(Mortality) <span class="sc">|&gt;</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>  <span class="fu">make_pr</span>(.smooth) <span class="sc">|&gt;</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">fdm =</span> <span class="fu">FDM</span>(<span class="fu">log</span>(.smooth), <span class="at">coherent =</span> <span class="cn">TRUE</span>))</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="fu">autoplot</span>(fit_mortality, <span class="dv">2</span>)</span></code></pre></div>
</div>
<div id="fertility-model" class="section level2">
<h2>Fertility model</h2>
<p>For fertility, we use a functional mean model with a square root
transformation, applied to the last 13 years of data. The plotted model
shows the fitted values on the square root scale.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>fit_fertility <span class="ot">&lt;-</span> norway_fertility <span class="sc">|&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">&gt;</span> <span class="dv">2010</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  <span class="fu">smooth_fertility</span>(Fertility) <span class="sc">|&gt;</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">fmean =</span> <span class="fu">FMEAN</span>(<span class="fu">sqrt</span>(.smooth)))</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="fu">autoplot</span>(fit_fertility)</span></code></pre></div>
</div>
<div id="net-migration-model" class="section level2">
<h2>Net migration model</h2>
<p>For net migration, we use a coherent functional data model. Because
net migration values can be positive or negative, we can’t take products
and ratios. Instead, we need to compute the means and corresponding
differences using the <code>mean_sd()</code> function.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>netmig <span class="ot">&lt;-</span> <span class="fu">net_migration</span>(</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>  norway_mortality <span class="sc">|&gt;</span> <span class="fu">filter</span>(Sex <span class="sc">!=</span> <span class="st">&quot;Total&quot;</span>),</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>  norway_births</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>  <span class="fu">make_sd</span>(NetMigration)</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>fit_migration <span class="ot">&lt;-</span> netmig <span class="sc">|&gt;</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">fdm =</span> <span class="fu">FDM</span>(NetMigration, <span class="at">coherent =</span> <span class="cn">TRUE</span>))</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="fu">autoplot</span>(fit_migration)</span></code></pre></div>
</div>
<div id="population-simulation" class="section level2">
<h2>Population simulation</h2>
<p>The <code>generate_population()</code> function takes a starting
population, and the three component models, and simulates future
age-sex-specific population values. Here we produce ten replicates of
the future population.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>pop <span class="ot">&lt;-</span> norway_mortality <span class="sc">|&gt;</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>  <span class="fu">filter</span>(Sex <span class="sc">!=</span> <span class="st">&quot;Total&quot;</span>, Year <span class="sc">==</span> <span class="fu">max</span>(Year))</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>future <span class="ot">&lt;-</span> <span class="fu">generate_population</span>(</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>  <span class="at">starting_population =</span> pop,</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>  <span class="at">mortality_model =</span> fit_mortality,</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>  <span class="at">fertility_model =</span> fit_fertility,</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>  <span class="at">migration_model =</span> fit_migration,</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>  <span class="at">h =</span> <span class="dv">10</span>,</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>  <span class="at">n_reps =</span> <span class="dv">500</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>)</span></code></pre></div>
<p>The first replicate is plotted below, along with the last few years
of historical data.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>future <span class="sc">|&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>  <span class="fu">filter</span>(.rep <span class="sc">==</span> <span class="st">&quot;100&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Age, <span class="at">y =</span> Population, <span class="at">group =</span> Year, <span class="at">color =</span> Year)) <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>    <span class="at">data =</span> norway_mortality <span class="sc">|&gt;</span> <span class="fu">filter</span>(Year <span class="sc">&gt;</span> <span class="dv">2010</span>, Sex <span class="sc">!=</span> <span class="st">&quot;Total&quot;</span>),</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>,</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">group =</span> Year)</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>  )  <span class="sc">+</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>  <span class="fu">scale_color_gradientn</span>(<span class="at">colours =</span> <span class="fu">rainbow</span>(<span class="dv">10</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>]) <span class="sc">+</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> Sex)</span></code></pre></div>
<p>The simulated populations can be used to compute any quantities that
can be derived from populations numbers by sex and age. For example, the
mean age of the population for the next 10 years</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>future <span class="sc">|&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>  <span class="fu">group_by</span>(Sex, .rep) <span class="sc">|&gt;</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_age =</span> <span class="fu">sum</span>(Population <span class="sc">*</span> (Age <span class="sc">+</span> <span class="fl">0.5</span>)) <span class="sc">/</span> <span class="fu">sum</span>(Population)) <span class="sc">|&gt;</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>  <span class="fu">group_by</span>(Sex) <span class="sc">|&gt;</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_age =</span> <span class="fu">mean</span>(mean_age))</span></code></pre></div>
<p>We can also plot population pyramids with prediction intervals. For
example, here is the population pyramid for 2032 with a 95% prediction
interval.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>pyramid_2032 <span class="ot">&lt;-</span> future <span class="sc">|&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">==</span> <span class="dv">2032</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Population =</span> <span class="fu">if_else</span>(Sex <span class="sc">==</span> <span class="st">&quot;Female&quot;</span>, <span class="sc">-</span>Population, Population)) <span class="sc">|&gt;</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>  <span class="fu">group_by</span>(Age, Sex) <span class="sc">|&gt;</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>    <span class="at">lo =</span> <span class="fu">quantile</span>(Population, <span class="fl">0.025</span>),</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>    <span class="at">med =</span> <span class="fu">quantile</span>(Population, <span class="fl">0.5</span>),</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>    <span class="at">hi =</span> <span class="fu">quantile</span>(Population, <span class="fl">0.975</span>)</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>  )</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>pyramid_2032 <span class="sc">|&gt;</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Age)) <span class="sc">+</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lo, <span class="at">ymax =</span> hi, <span class="at">colour =</span> <span class="cn">NULL</span>),</span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;#c14b14&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.2</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> med), <span class="at">color =</span> <span class="st">&quot;#c14b14&quot;</span>) <span class="sc">+</span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> Sex, <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Population&quot;</span>) <span class="sc">+</span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">&quot;none&quot;</span>, <span class="at">alpha =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="unnumbered">References</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-HB08" class="csl-entry">
Hyndman, Rob J, and Heather Booth. 2008. <span>“Stochastic Population
Forecasts Using Functional Data Models for Mortality, Fertility and
Migration.”</span> <em>International J Forecasting</em> 24 (3): 323–42.
<a href="https://robjhyndman.com/publications/stochastic-population-forecasts/">https://robjhyndman.com/publications/stochastic-population-forecasts/</a>.
</div>
<div id="ref-hby" class="csl-entry">
Hyndman, Rob J, Heather Booth, and Farah Yasmeen. 2013. <span>“Coherent
Mortality Forecasting: The Product-Ratio Method with Functional Time
Series Models.”</span> <em>Demography</em> 50 (1): 261–83. <a href="https://robjhyndman.com/publications/coherentfdm/">https://robjhyndman.com/publications/coherentfdm/</a>.
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
